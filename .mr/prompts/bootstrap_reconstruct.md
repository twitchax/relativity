# microralph — Bootstrap Reconstruct Prompt

## Objective

Analyze the repository's git history (commits, tags, and major changes) to infer historical PRDs representing major development milestones.

## Context

You are running `mr bootstrap` on an existing repository that has development history but no PRDs. Reconstruct mode is the default behavior. Your goal is to create PRDs that represent the major milestones and features that have already been completed.

## Required Analysis

1. **Analyze Git History**
   - Review commit messages for patterns indicating features, fixes, and milestones
   - Identify version tags and releases
   - Look for merge commits indicating major feature branches
   - Detect clusters of related commits that represent cohesive work

2. **Identify Major Milestones**
   - Focus on significant features, not incremental bug fixes
   - Look for architectural changes, new modules, or major refactors
   - Prioritize work that would naturally be described as a "project" or "epic"
   - Aim for 3-10 PRDs representing the most significant completed work

3. **Infer Temporal Dependencies**
   - Earlier milestones should be dependencies of later ones where logical
   - Use commit timestamps and tag ordering to establish sequence
   - Foundation work (setup, core modules) should be dependencies of features built on them

4. **Consider Existing Structure**
   - Check for existing PRDs in `.mr/prds/` and avoid duplicating their scope
   - Review README, CHANGELOG, and documentation for feature descriptions
   - Look at module structure to understand architectural evolution

## Existing PRDs (Do Not Duplicate)

{{#if existing_prds}}
The following PRDs already exist in this repository. **Do NOT create new PRDs that duplicate their scope.** Only create new PRDs for completed work not already covered by these:

{{#each existing_prds}}
- **{{id}}**: {{title}} ({{status}})
{{/each}}

When inferring dependencies for new PRDs, you may reference these existing PRD IDs in the `depends_on` field.
{{/if}}
{{#unless existing_prds}}
No existing PRDs found. You may create PRDs for all significant completed work.
{{/unless}}

## Output Format

For each inferred PRD, create a file in `.mr/prds/` with:

### Frontmatter

```yaml
---
id: PRD-NNNN
title: "Descriptive title of the milestone"
status: done
owner: "{{owner}}"
created: YYYY-MM-DD   # First commit date for this work
updated: YYYY-MM-DD   # Last commit date for this work
reconstructed: true   # Mark as reconstructed from history

depends_on:           # PRD IDs that this work built upon
- PRD-XXXX
- PRD-YYYY

principles:
- Key principle or constraint that guided this work

acceptance_tests:
- id: uat-001
  name: Primary acceptance criteria (inferred from the completed work)
  command: cargo make uat
  uat_status: verified   # Assume verified since work is complete

tasks:
- id: T-001
  title: "Main task that was completed"
  priority: 1
  status: done
  notes: "Inferred from commits/tags"
---
```

### Markdown Body

Include:
- **Summary**: Brief description of what was accomplished
- **Problem**: What problem this milestone solved (inferred)
- **Goals**: What goals were achieved
- **History**: Single entry noting reconstruction

```markdown
# Summary

Brief description of the completed milestone.

# Problem

The problem or need this work addressed.

# Goals

1. Goal that was achieved
2. Another achieved goal

# History

## YYYY-MM-DD — Reconstructed from Git History
- **Source**: Inferred from commits [hash1, hash2, ...] and/or tag [vX.Y.Z]
- **Status**: ✅ Reconstructed
- **Notes**: This PRD was automatically generated by `mr bootstrap`
```

## Constraints

- Only create PRDs for **completed work** with `status: done`
- Always set `reconstructed: true` in the frontmatter
- Infer `depends_on` based on temporal and logical dependencies
- Use realistic dates from git history for `created` and `updated`
- Keep task lists minimal (1-3 tasks per PRD representing main accomplishments)
- Do not recreate work already covered by existing PRDs

## YAML Frontmatter Quoting Rules

**CRITICAL**: YAML strings containing special characters MUST be quoted:
- **Colons (`:`)**: Any string with a colon must be quoted: `title: "Fix: Bug in parser"`
- **Hashes (`#`)**: Strings with `#` must be quoted to avoid comment interpretation
- When in doubt, wrap string values in double quotes.

## After Generation

1. Run `mr list` to regenerate the PRD index
2. The new PRDs will appear as "done" in the index
3. Future `mr new` PRDs can reference these as dependencies

## Output

After creating the reconstructed PRDs, report:
- How many PRDs were created
- Brief summary of each (title and date range)
- The dependency graph that was inferred
